<!DOCTYPE html><html lang="cn"><head><meta charset="utf-8"><title>NkCTF WP | 1z到底e不e.? | It&#39;s Ba0k</title><meta name="author" content="Ba0k"><meta name="description" content="Life's a struggle..."><meta name="keywords" content=""><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0"><link rel="icon" href="/favicon.ico"><link rel="preconnect" href="https://cdn.staticfile.org"><script src="https://cdn.staticfile.org/vue/3.3.7/vue.global.prod.min.js"></script><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.4.2/css/all.min.css"><script>const mixins = {};</script><script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script><script src="https://cdn.staticfile.org/highlight.js/11.9.0/highlight.min.js"></script><script src="https://cdn.staticfile.org/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script><link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/11.9.0/styles/github.min.css"><script src="/js/lib/highlight.js"></script><script src="/js/lib/preview.js"></script><link rel="stylesheet" href="/css/main.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="layout"><transition name="fade"><div id="loading" v-show="loading"><div id="loading-circle"><h2>LOADING...</h2></div></div></transition><div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}"><nav id="desktop-menu"><a class="title" href="/"><span>IT&#39;S BA0K</span> </a><a href="/"><i class="fa-solid fa-house fa-fw"></i> <span>&ensp;Home</span> </a><a href="/about"><i class="fa-solid fa-id-card fa-fw"></i> <span>&ensp;About</span> </a><a href="/archives"><i class="fa-solid fa-box-archive fa-fw"></i> <span>&ensp;Archives</span> </a><a href="/categories"><i class="fa-solid fa-bookmark fa-fw"></i> <span>&ensp;Categories</span> </a><a href="/tags"><i class="fa-solid fa-tags fa-fw"></i> <span>&ensp;Tags</span></a></nav><nav id="mobile-menu"><div class="title" @click="showMenuItems = !showMenuItems"><i class="fa-solid fa-bars fa-fw"></i> <span>&emsp;IT&#39;S BA0K</span></div><transition name="slide"><div class="items" v-show="showMenuItems"><a href="/"><div class="item"><div style="min-width:20px;max-width:50px;width:10%"><i class="fa-solid fa-house fa-fw"></i></div><div style="min-width:100px;max-width:150%;width:20%">Home</div></div></a><a href="/about"><div class="item"><div style="min-width:20px;max-width:50px;width:10%"><i class="fa-solid fa-id-card fa-fw"></i></div><div style="min-width:100px;max-width:150%;width:20%">About</div></div></a><a href="/archives"><div class="item"><div style="min-width:20px;max-width:50px;width:10%"><i class="fa-solid fa-box-archive fa-fw"></i></div><div style="min-width:100px;max-width:150%;width:20%">Archives</div></div></a><a href="/categories"><div class="item"><div style="min-width:20px;max-width:50px;width:10%"><i class="fa-solid fa-bookmark fa-fw"></i></div><div style="min-width:100px;max-width:150%;width:20%">Categories</div></div></a><a href="/tags"><div class="item"><div style="min-width:20px;max-width:50px;width:10%"><i class="fa-solid fa-tags fa-fw"></i></div><div style="min-width:100px;max-width:150%;width:20%">Tags</div></div></a></div></transition></nav></div><transition name="fade"><div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div></transition><div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'"><div class="article"><div><h1>NkCTF WP | 1z到底e不e.?</h1></div><div class="info"><span class="date"><span class="icon"><i class="fa-solid fa-calendar fa-fw"></i> </span>2024/3/26 </span><span class="category"><a href="/categories/%E5%AD%A6%E4%B9%A0/"><span class="icon"><i class="fa-solid fa-bookmark fa-fw"></i> </span>学习 </a></span><span class="tags"><span class="icon"><i class="fa-solid fa-tags fa-fw"></i> </span><span class="tag"><a href="/tags/%E7%94%B5%E5%AD%90%E5%8F%96%E8%AF%81/" style="color:#4f5b4f">电子取证</a></span></span></div><div class="content" v-pre><p>一道2解的电子取证，送给各位。</p><span id="more"></span><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>好像大家对电子取证都没什么兴趣，不管赛前赛时赛后都很少有人问，而且解题都很少。可能都去玩MC了:)</p><br><h3 id="1z-F0r3ns1c5"><a href="#1z-F0r3ns1c5" class="headerlink" title="1z_F0r3ns1c5"></a>1z_F0r3ns1c5</h3><blockquote><p>本鼠鼠正在Coding，突然一声OPEN THE DOOR！本鼠鼠直接鼠躯一颤就双手抱头蹲下了，果然 本鼠鼠只适合生活在阴暗的下水道 被黑猫警长抓走的时候本鼠鼠还想辩解一下，但是他们拿出你的照片的时候，本鼠鼠认罪了 昨晚和其他鼠鼠聊天的时候其他鼠鼠问本鼠鼠：“你到底喜欢她什么啊？” “喜欢一个人不需要理由” 本鼠鼠很快敲完了键盘，刚要按下回车的时候突然愣住了。 真的不需要理由吗？ 请找到鼠鼠的答案吧。</p></blockquote><p>README.txt</p><blockquote><p>本鼠鼠的flag总共分为三段捏，flag为nkctf{uuid}形式，另外鼠鼠最喜欢等宽字体了，快快去找吧。</p></blockquote><p>先vol老三样一把梭</p><h4 id="flag1"><a href="#flag1" class="headerlink" title="flag1"></a>flag1</h4><p>在env中发现一段奇怪的编码，Variable值为n0wayback，恰好本次比赛的官网有个战队就叫n0wayback，这究竟是道德的沦丧还是人性的扭曲</p><p><img src="/images/image-20240327090801406.png" alt="image-20240327090801406"></p><pre><code>.\volatility.exe -f .\1.raw --profile=Win7SP1x64 envars
</code></pre><pre><code>HPahXR4NvAnZXB16tNK6hAaNVNU++
nkctf&#123;39c429eb-2faf
</code></pre><p><code>xxcoed</code>解码后即可得到第一段flag</p><h4 id="flag2"><a href="#flag2" class="headerlink" title="flag2"></a>flag2</h4><p>从进程中发现了<code>mspaint.exe</code>，PID为2052</p><p><img src="/images/image-20240327090914789.png" alt="image-20240327090914789"></p><pre><code>.\volatility.exe -f .\1.raw --profile=Win7SP1x64 pslist
</code></pre><p>dump出来，后缀改为<code>data</code>，后用GIMP打开，更改数值</p><pre><code>.\volatility.exe -f .\1.raw --profile=Win7SP1x64 memdump -p 2052 -D ./
</code></pre><p>具体思路就是分辨率按照现实中的分辨率来改，不过也会有偏差，看着来就行了，差不多能看到东西后更改位移的数值，慢慢调整就能得到信息。</p><p>感觉像一个非常巨大的CD，一点点位移看不出来什么，大步大步的就会出现畸变。</p><p><img src="/images/image-20240326144732348.png" alt="image-20240326144732348"></p><h4 id="flag3"><a href="#flag3" class="headerlink" title="flag3"></a>flag3</h4><p>查看cmd时发现<code>git clone</code>了一份源码</p><p><img src="/images/image-20240327091152224.png" alt="image-20240327091152224"></p><pre><code>Cmd #0 @ 0x10bc40: git clone https://github.com/5ime/Secret_Generator.git
</code></pre><p>直接访问发现了一份README</p><blockquote><h1 id="Secret-Generator"><a href="#Secret-Generator" class="headerlink" title="Secret Generator"></a>Secret Generator</h1><blockquote><p>The clandestine tool for enigmatic endeavors.</p></blockquote><p>Caution</p><p>Compilable with Dockerfile or Python 3.7.2 only.</p><p>Hey, hold on a second… Where’s my source code?</p></blockquote><p>要用到Docker且py3.7.2的环境下启动</p><p>手动下载</p><p>查看更新历史</p><p>再回退版本后得到源代码</p><p><img src="/images/image-20240327091406425.png" alt="image-20240327091406425"></p><p>这里居然得到了一个flag，可惜是假的，心跳加速瞬间:(</p><p>接着开启docker</p><pre><code>cd ./Secret_Generator/docker
docker-compose up -d
</code></pre><p>访问<code>8080</code>端口，是一个web界面，要求输入文字和上传字体文件，也就是<code>ttf</code>文件</p><p><img src="/images/image-20240327091855474.png" alt="image-20240327091855474"></p><p>这里最<strong>抽象</strong>的来了，一开始的<code>readme.txt</code>不仅提示了flag有三段，还说最喜欢等宽字体了，一般只有编程才会用到等宽字体，题目描述还正在<code>coding</code>，联想到vscode，再加上内存进程中也有，再加上画图截图上也能看到vscode，更加确定了这个可能性，百度了一下，找到vscode的默认字体配置文件就能找到要找的文件名了，<code>Fira Code</code>，而上面的输入框，输入正序大小写字母和数字即可。</p><pre><code>ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789
FiraCode-Regular.ttf
</code></pre><p>点击<code>Generate Secret Image</code>后生成了一张对比图和之前已经下载的<code>某段flag</code></p><p><img src="/images/image-20240327092015918.png" alt="image-20240327092015918"></p><p><img src="/images/image-20240327092023662.png" alt="image-20240327092023662"></p><p>剩下的意思就很明了了，原来的图是一张被马赛克所加密了的图片，现在生成了一张同样字体但是没有被马赛克所加密的图片，我们可以直接手动用马赛克覆盖生成的图片然后对比之前的图片得到密文。</p><p>但是与此同时也出现了问题，因为生成的图片是被后端做了修改的，前面加了<code>pass[空格]</code>，可以在字母表前面加个<code>AAAAA</code>字符，以及末尾多加了一个<code>9</code>，原因在于前五位和最后一位不加密，且前五位为固定的 <code>pass[空格]</code> ，这样在切割的时候，且前五个字符会直接被覆盖（文件命 名时不允许存在同名文件）</p><p>下面因为需要切割图片，所以要知道每个字符所占的宽高，直接图片宽度&#x2F;字符数量即可。</p><p>接下来请出我们人类的好朋友：Chat GPT</p><blockquote><p>我有一张 <code>xxx.png</code> 图片，宽高为 <code>1086*60</code>，请通过 Python 的 <code>PIL</code> 库将它裁剪为 <code>30*60</code> 的图 片，切割出来的图片保存到 <code>dict</code> 文件夹中，另外切割出的图片命名规则根据如下命名表 ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789 最后，如果文件名为大写字母则 <code>文件名-大写.png</code></p></blockquote><pre><code class="python">from PIL import Image
import os

# 打开图片
img = Image.open(&quot;index.png&quot;)

# 获取图片尺寸
width, height = img.size

# 定义切割尺寸
tile_width = 30
tile_height = 60

# 确保切割后的图片尺寸可以被整除
assert width % tile_width == 0 and height % tile_height == 0

# 创建马赛克文件夹
if not os.path.exists(&quot;马赛克&quot;):
    os.makedirs(&quot;马赛克&quot;)

# 定义命名规则
char_set = &quot;AAAAAABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-&quot;

# 切割图片并保存
for i in range(width // tile_width):
    for j in range(height // tile_height):
        tile = img.crop((i * tile_width, j * tile_height, (i + 1) * tile_width, (j + 1) * tile_height))
        index = i * (height // tile_height) + j
        filename = f&quot;马赛克/&#123;char_set[index]&#125;.png&quot;
        tile.save(filename)

print(&quot;切割完成并保存到马赛克文件夹中。&quot;)
</code></pre><p>切割完成比对即可，再次请出好朋友</p><pre><code class="python">import os
import hashlib
def calculate_md5(filename):
    &quot;&quot;&quot;计算文件的 MD5 值&quot;&quot;&quot;
    hasher = hashlib.md5()
    with open(filename, &#39;rb&#39;) as f:
        for chunk in iter(lambda: f.read(4096), b&quot;&quot;):
            hasher.update(chunk)
    return hasher.hexdigest()
def get_file_md5(folder):
    &quot;&quot;&quot;获取文件夹中所有文件的 MD5 值&quot;&quot;&quot;
    file_md5_dict = &#123;&#125;
    for file_name in os.listdir(folder):
        file_path = os.path.join(folder, file_name)
        if os.path.isfile(file_path):
            file_md5_dict[file_name] = calculate_md5(file_path)
    return file_md5_dict
# 读取 dict 文件夹中的所有文件的 MD5 值并存储到字典中
dict_folder = &quot;dict&quot;
dict_md5 = get_file_md5(dict_folder)

# 读取 pass 文件夹中的所有文件的 MD5 值并存储到字典中
pass_folder = &quot;pass&quot;
pass_md5 = get_file_md5(pass_folder)

# 找到 pass 文件夹中与 dict 文件夹中 MD5 值相同的文件名对应的 dict 中的 key
common_keys = [key for key, value in pass_md5.items() if value in
dict_md5.values()]

print(&quot;Pass 文件夹中与 Dict 文件夹中 MD5 值相同的文件名:&quot;)

flag = &#39;&#39;
for key in common_keys:
    matching_keys = [k for k, v in dict_md5.items() if v == pass_md5[key]]
    for matching_key in matching_keys:
        flag += matching_key.split(&#39;.png&#39;)[0]
print(flag + &#39;3&#39;)
</code></pre><p>基本没什么问题，稍微修改一下即可。</p><p>运行后得到一个字符串，我还以为是flag，但是一点都不像。是<code>某段flag</code>文件夹中的<code>secret</code>的容器密码</p><p>VeraCrypt加载后即可得到最后一个flag。</p><p>1z不e</p><p>将军，北伐成功了。</p></div></div><footer id="footer"><div id="footer-wrap"><div>&copy; 2022 - 2024 It&#39;s Ba0k <span id="footer-icon"><i class="fa-solid fa-font-awesome fa-fw"></i> </span>&commat;Ba0k</div><div>Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp; <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a></div></div></footer></div><transition name="fade"><div id="preview" ref="preview" v-show="previewShow"><img id="preview-content" ref="previewContent"></div></transition></div><script src="/js/main.js"></script></body></html>